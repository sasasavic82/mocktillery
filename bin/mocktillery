#! /usr/bin/env node

const program = require('commander');

const { TestType, Mocktillery } = require("../dist/index");

program
    .version("0.0.1")
    .option("-u, --url [url]", "URL to test")
    .option("-t, --testsFolder [tests folder]", "Tests folder")
    .option("-c, --compileFolder [compile folder]", "Compile folder")
    .option("-o, --output [output filename]", "Output filename (no extensions)")
    .option("-d, --debug", "Debug flag")
    .parse(process.argv);


let debug = false;

if (!program.url)
    throw new Error("Must supply a valid url");

if (!program.testsFolder)
    throw new Error("Must supply a test folder");

if (!program.compileFolder)
    throw new Error("Must supply compile folder");

if (!program.output)
    throw new Error("Must supply output filename");

if (program.debug)
    debug = true;

let url = program.url;
let testsFolder = program.testsFolder;
let compileFolder = program.compileFolder;
let outputFilename = program.output;

const config = {
    type: TestType.Functional,
    testFolder: testsFolder,
    compileFolder: compileFolder,
    outputFilename: outputFilename,
    debug: debug
}

let mocktillery = new Mocktillery(config);

mocktillery.loadTests();
mocktillery.compile();
mocktillery.run(url, true);