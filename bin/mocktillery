#! /usr/bin/env node

const program = require('commander');

const { TestType, Mocktillery } = require("../dist/index");

let debug = false;

program
    .command("compile")
    .option("-t, --testsFolder [tests folder]", "Tests folder")
    .option("-c, --compileFolder [compile folder]", "Compile folder")
    .option("-o, --output [output filename]", "Output filename (no extensions)")
    .option("-d, --debug", "Debug flag")
    .action((cmdObj) => {

        if (!cmdObj.testsFolder)
            throw new Error("Must supply a test folder");
        
        if (!cmdObj.compileFolder)
            throw new Error("Must supply compile folder");
        
        if (!cmdObj.output)
            throw new Error("Must supply output filename");
        
        if (cmdObj.debug)
            debug = true;

        const config = {
            type: TestType.Functional,
            testFolder: cmdObj.testsFolder,
            compileFolder: cmdObj.compileFolder,
            outputFilename: cmdObj.output,
            debug: debug
        }
        
        let mocktillery = new Mocktillery(config);
        
        mocktillery.loadTests();
        mocktillery.compile();

    });

program
    .command("evaluate")
    .option("-t, --testFile <file>", "mocktillery test output file")
    .option("-d, --debug", "Debug flag")
    .action((cmdObj) => {

        if (!cmdObj.testFile)
            throw new Error("Must supply mocktillery test output file");
        
        if (cmdObj.debug)
            debug = true;
        
        Mocktillery.evaluateTest(cmdObj.testFile);

    });
    

program.parse(process.argv);